# 极客时间--趣谈Linux操作系统

+ [从QQ操作看系统运行](#从QQ操作看系统运行)
+ [几个常用的系统调用](#几个常用的系统调用)
  + [进程管理](#进程管理)
  + [内存管理](#内存管理)
  + [文件管理](#文件管理)
  + [信号管理](#信号管理)
  + [进程间通信](#进程间通信)

> 将操作系统想象成一个外包公司的老板，将这家公司的发展阶段分为这样几个时期：
> 初创期：这个老板基于开放的营商环境（x86 体系结构），创办一家外包（系统的启动）。因为一开始没有其他员工，老板需要亲自接项目（实模式）。
> 发展期：公司慢慢做大，项目越接越多（保护模式，多进程），为了管理各个外包项目，建立了项目管理体系（进程管理），会议室管理体系（内存管理），文档资料管理系统（文件系统），售前售后体系（输入输出设备管理）。
> 壮大期：公司越来越牛，开始促进内部项目的合作（进程间通信）和外部公司合作（网络通信）
> 集团化：公司业务越来越多，会成立多家子公司（虚拟化），或者鼓励内部创业（容器化），这个时候公司就变成集团。大管家的调度能力不再局限于一家公司，而是集团公司（Linux集群），从而成功上市（从单机操作系统到数据中心操作系统）。

## 从QQ操作看系统运行

鼠标双击 QQ 会触发一个中断，操作系统调用中断处理函数，操作系统发现双击的是一个图标，就明白了用户的原始诉求，准备运行 QQ 和别人聊天。

运行 QQ 是一件大事，因为在将来一段时间，用户要一直和 QQ 进行交互，QQ 程序需要将它可能进行的操作写在程序里面，并且编译成二进制。

操作系统想要存储 QQ 程序，需要按照规定将硬盘格式化，成为文件系统。文件系统需要一个系统进行统一管理，称为`文件管理子系统`。

QQ 的二进制文件是静态的，称为`程序`，而运行起来的 QQ，是不断进行的，称为`进程`。

在一个操作系统中，会同时存在多个进程，这些进程可能同时访问一些具有权限的资源，这些操作不能随便操作，操作系统提供了访问这些资源的方式，即`系统调用`。

在操作系统中要运行一个进程，需要分配 CPU 进行执行，这也是通过系统调用实现的。为了管理这些进程，需要一个`进程管理子系统`。

不同的进程有不同的内存空间，为了对进程进行统一的内存管理和分配，需要`内存管理子系统`。

QQ 运行之后，通过键盘敲击，会触发中断，操作系统这个事件给 QQ 进程，由 QQ 进程来处理，用户输入完毕后，QQ 会调用系统调用，系统调用通过网卡发送数据。

## 几个常用的系统调用

### 进程管理

> 关于进程管理，fork 调用之后，子进程和父进程之间如何执行有所不明白

创建进程 fork：要创建一个新的进程，需要一个老的进程调用 fork 来实现，其中老的进程叫作`父进程`，新的进程叫作`子进程`。 每个进程执行都需要一些配置，调用 fork 系统调用时，子进程会复制父进程的配置，然后根据实际情况进行修改。

### 内存管理

在操作系统中，每个进程都有自己的内存，互相之间不干扰，有独立的进程内存空间。

每个内存空间包含：

+ 代码段：存放程序代码
+ 数据段：存放进程中产生的数据
+ 堆：动态分配，会较长事件保存，指明才销毁

进程要去使用部分内存时，会使用内存管理的系统调用来登记，但是这并不代表真的就对应到了物理内存，只有真的写入数据的时候，发现没有对应物理内存，才会触发一个中断，现分配物理内存。

两个在堆里面分配内存的系统调用，brk 和 mmap。brk 会和原来的堆的数据连在一起，当分配内存数量比较大的时候，使用 mmap，会重新划分一块区域。

### 文件管理

在 Linux 中，一切皆文件。

几个常用的文件管理系统调用：

+ open：打开文件
+ close： 关闭文件
+ create：创建不存在的文件
+ lseek：跳到文件的某个位置
+ read：读文件
+ write：写文件

### 信号管理

对于程序运行过程中遇到的异常情况，比如在执行一个程序的时候，在键盘输入 "CTRL+C"，进程会收到这些信号，进程需要决定如何处理这些异常情况。

Linux 中对于每中信号都定义了默认的动作，进程也可以使用 `sigaction` 系统调用注册一个信号处理函数。

### 进程间通信

操作系统之间可能有多个进程，这些进程可能需要进行数据交互，对于数据交互不大的情况，可以使用`消息队列`，这个消息队列在